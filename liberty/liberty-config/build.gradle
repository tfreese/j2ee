plugins {
    id "war"
}

description = "Demo for Liberty-Configuration"

dependencies {
    implementation("org.hibernate.orm:hibernate-core") {
        exclude group: "jakarta.activation", module: "*"
        exclude group: "jakarta.inject", module: "*"
        exclude group: "jakarta.persistence", module: "*"
        exclude group: "jakarta.transaction", module: "*"
        exclude group: "jakarta.xml.bind", module: "*"
    }
    implementation("org.slf4j:slf4j-api")

    // providedCompile
    compileOnly("io.openliberty.api:io.openliberty.transaction")
    compileOnly("jakarta.platform:jakarta.jakartaee-api")

    runtimeOnly("ch.qos.logback:logback-classic")
    runtimeOnly("org.hsqldb:hsqldb")
}

// Register ANT-Tasks as Gradle-Tasks with Prefix "ant-" in Group "other".
ant.importBuild("ant_build.xml") { antTargetName -> "ant-" + antTargetName }

// Set group property for all Ant tasks.
tasks.matching { task -> task.name.startsWith("ant-") }.configureEach { group = "Ant" }

clean.finalizedBy("ant-clean")

tasks.register("copyDependencies") {
    group = "My Tasks"
    description "Copy Dependencies to folder"

    doLast {
        ant.lifecycleLogLevel = "INFO"

        def libFolder = layout.buildDirectory.dir("dependencies")

        println("copy Dependencies to: " + libFolder.get())

        delete libFolder

        copy {
            from configurations.runtimeClasspath - configurations.providedCompile {
                include "*.jar"
                include "*.rar"
                //    exclude "ohj*"
            }

            into libFolder
        }
    }
}

//build.finalizedBy("copyDependencies", "ant-deploy")
